!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var o,c,l,p,d,u,e,t,a,n,i,f,m,s,r;o=Object.create,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,d=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,a=(e=(e,t)=>function(){return t||(0,e[p(e)[0]])((t={exports:{}}).exports,t),t.exports})({"external-global-plugin:react-dom"(e,t){t.exports=Spicetify.ReactDOM}}),n=(t=(e,t,a)=>{a=null!=e?o(d(e)):{};var i=!t&&e&&e.__esModule?a:c(a,"default",{value:e,enumerable:!0}),s=e,r=void 0,n=void 0;if(s&&"object"==typeof s||"function"==typeof s)for(let e of p(s))u.call(i,e)||e===r||c(i,e,{get:()=>s[e],enumerable:!(n=l(s,e))||n.enumerable});return i})(e({"external-global-plugin:react"(e,t){t.exports=Spicetify.React}})()),i=t(a()),f=class{constructor(e,t,a={}){this.name=e,this.settingsId=t,this.initialSettingsFields=a,this.settingsFields=this.initialSettingsFields,this.setRerender=null,this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,t])=>{"button"!==t.type&&void 0===this.getFieldValue(e)&&this.setFieldValue(e,t.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{"/preferences"===e.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()},this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())},this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(e=>setTimeout(e,100))}var e=document.querySelector(".main-view-container__scroll-node-child main div");if(!e)return console.error("[spcr-settings] settings container not found");let t=Array.from(e.children).find(e=>e.id===this.settingsId);t?console.log(t):((t=document.createElement("div")).id=this.settingsId,e.appendChild(t)),i.default.render(n.default.createElement(this.FieldsContainer,null),t)},this.addButton=(e,t,a,i,s)=>{this.settingsFields[e]={type:"button",description:t,value:a,events:{onClick:i,...s}}},this.addInput=(e,t,a,i,s,r)=>{this.settingsFields[e]={type:"input",description:t,defaultValue:a,inputType:s,events:{onChange:i,...r}}},this.addHidden=(e,t)=>{this.settingsFields[e]={type:"hidden",defaultValue:t}},this.addToggle=(e,t,a,i,s)=>{this.settingsFields[e]={type:"toggle",description:t,defaultValue:a,events:{onChange:i,...s}}},this.addDropDown=(e,t,a,i,s,r)=>{this.settingsFields[e]={type:"dropdown",description:t,defaultValue:a[i],options:a,events:{onSelect:s,...r}}},this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(this.settingsId+"."+e)||"{}")?.value,this.setFieldValue=(e,t)=>{Spicetify.LocalStorage.set(this.settingsId+"."+e,JSON.stringify({value:t}))},this.FieldsContainer=()=>{var[e,t]=(0,n.useState)(0);return this.setRerender=t,n.default.createElement("div",{className:"x-settings-section",key:e},n.default.createElement("h2",{className:"TypeElement-cello-textBase-type"},this.name),Object.entries(this.settingsFields).map(([e,t])=>n.default.createElement(this.Field,{nameId:e,field:t})))},this.Field=a=>{var e=this.settingsId+"."+a.nameId;let t;if(t="button"===a.field.type?a.field.value:this.getFieldValue(a.nameId),"hidden"===a.field.type)return n.default.createElement(n.default.Fragment,null);const[i,s]=(0,n.useState)(t),r=e=>{void 0!==e&&(s(e),this.setFieldValue(a.nameId,e))};return n.default.createElement("div",{className:"x-settings-row"},n.default.createElement("div",{className:"x-settings-firstColumn"},n.default.createElement("label",{className:"TypeElement-viola-textSubdued-type",htmlFor:e},a.field.description||"")),n.default.createElement("div",{className:"x-settings-secondColumn"},"input"===a.field.type?n.default.createElement("input",{className:"x-settings-input",id:e,dir:"ltr",value:i,type:a.field.inputType||"text",...a.field.events,onChange:e=>{r(e.currentTarget.value);var t=a.field.events?.onChange;t&&t(e)}}):"button"===a.field.type?n.default.createElement("span",null,n.default.createElement("button",{id:e,className:"Button-sc-y0gtbx-0 Button-small-buttonSecondary-useBrowserDefaultFocusStyle x-settings-button",...a.field.events,onClick:e=>{r();var t=a.field.events?.onClick;t&&t(e)},type:"button"},i)):"toggle"===a.field.type?n.default.createElement("label",{className:"x-settings-secondColumn x-toggle-wrapper"},n.default.createElement("input",{id:e,className:"x-toggle-input",type:"checkbox",checked:i,...a.field.events,onClick:e=>{r(e.currentTarget.checked);var t=a.field.events?.onClick;t&&t(e)}}),n.default.createElement("span",{className:"x-toggle-indicatorWrapper"},n.default.createElement("span",{className:"x-toggle-indicator"}))):"dropdown"===a.field.type?n.default.createElement("select",{className:"main-dropDown-dropDown",id:e,...a.field.events,onChange:e=>{r(a.field.options[e.currentTarget.selectedIndex]);var t=a.field.events?.onChange;t&&t(e)}},a.field.options.map((e,t)=>n.default.createElement("option",{selected:e===i,value:t+1},e))):n.default.createElement(n.default.Fragment,null)))}}},s={ru:{error:"Ошибка",text:"Скопировать текст",songAndArtist:"Cкопировать трек и артиста",copied:"Скопировано",copyImage:"Ссылка на изображение",settings:{name:"Copy to clipboard settings",separator:"Separator between Song name and Artist names"}},en:{error:"Error",text:"Copy Text",songAndArtist:"Copy Song & Artist names",copied:"Copied",copyImage:"Copy image link",settings:{name:(m={ID:"settings-copy-to-clipboard",NAME:"Copy to clipboard settings",SEPARATOR:{KEY:"ctc-separator",DESCRIPTION:"Separator between Song name and Artist names",DEFAULT:"; "}}).NAME,separator:m.SEPARATOR.DESCRIPTION}},vi:{copied:"Đã sao chép",copyImage:"Sao chép liên kết ảnh",error:"Lỗi",settings:{name:"Cài đặt Copy to clipboard",separator:"Phân cách giữa tên bài hát và tên nghệ sĩ"},songAndArtist:"Sao chép tên bài hát & nghệ sĩ",text:"Sao chép tên"}},r=async function(){for(;!Spicetify||"complete"!==document.readyState;)await new Promise(e=>setTimeout(e,1e3));await new Promise(e=>setTimeout(e,1e3)),e=Spicetify.Locale?Spicetify.Locale.getLocale():"en";var e=await(Object.keys(s).includes(e)?s[e]:s.en),t=new f(e.settings.name,m.ID);t.addInput(m.SEPARATOR.KEY,e.settings.separator,m.SEPARATOR.DEFAULT),t.pushSettings(),E(e)},(async()=>{await r()})();async function y(e,t){try{var a=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/albums/"+t);return"image"===e?a.images[0].url:a.name}catch(e){throw console.log(e),new Error(e.message)}}async function g(e,t){var a=Spicetify.GraphQL.Definitions["queryArtistOverview"];try{var i=Spicetify.Locale?Spicetify.Locale.getLocale():"en",s=(await Spicetify.GraphQL.Request(a,{uri:t,includePrerelease:!1,locale:i,offset:0,limit:10}))["data"];if("image"!==e)return s.artistUnion.profile.name;var r=s.artistUnion.headerImage?.data?.sources?.[0]?.url;if(r)return r;throw new Error("No images")}catch(e){throw console.log(e),new Error(e.message)}}async function h(e){var t=Spicetify.GraphQL.Definitions["getTrackName"];try{var a=(await Spicetify.GraphQL.Request(t,{uri:e,offset:0,limit:10}))["data"];return a.trackUnion.name}catch(e){throw console.log(e),new Error(e.message)}}function S(e){if(e.includes("mosaic:"))throw new Error("Cannot copy mosaic image");if(e.startsWith("spotify")){var t=e.split(":").pop();if(t)return"https://i.scdn.co/image/"+t;throw new Error("Not found")}return e}async function w(e,t){try{var a=await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/spotify:playlist:"+t);return"name"===e?a.playlist.name:S(a.playlist.picture)}catch(e){throw console.log(e),new Error(e.message)}}async function v(e,t){try{var a=await Spicetify.CosmosAsync.get(`sp://core-show/v1/shows/${t}?responseFormat=protobufJson`);return"name"===e?a.header.showMetadata.name:S(a.header.showMetadata.covers.xlargeLink)}catch(e){throw console.log(e),new Error(e.message)}}async function I(e,t){try{var a=await Spicetify.Platform.ShowAPI.getEpisodeOrChapter("spotify:episode:"+t);return"name"===e?a.name:S(a.coverArt.reduce((e,t)=>e.width>t.width?e:t,{width:0,height:0,url:""}).url)}catch(e){throw console.log(e),new Error(e.message)}}async function A(e,t){try{var a=await Spicetify.CosmosAsync.get("sp://core-profile/v1/profiles",{usernames:t});return"name"===e?a.profiles[0].name:a.profiles[0].images.reduce((e,t)=>e.maxWidth>t.maxWidth?e:t,{maxWidth:0,maxHeight:0,url:""}).url}catch(e){throw console.log(e),new Error(e.message)}}function E(r){function n(e){e&&(Spicetify.showNotification(r.copied+": "+e),Spicetify.Platform.ClipboardAPI.copy(e))}new Spicetify.ContextMenu.Item(r.text,async e=>{var t=Spicetify.URI["Type"],a=Spicetify.URI.fromString(e[0]);const i=a._base62Id||a.id;try{switch(a.type){case t.TRACK:n(await h(a.toURI()));break;case t.LOCAL:var s=[];a.track&&s.push(a.track),a.artist&&s.push(a.artist),a.album&&s.push(a.album),n(s.join("; "));break;case t.LOCAL_ARTIST:n(""+(a.artist||""));break;case t.LOCAL_ALBUM:n(""+(a.album||""));break;case t.ALBUM:n(await y("name",a.id));break;case t.ARTIST:n(await g("name",a.toURI()));break;case t.PLAYLIST:case t.PLAYLIST_V2:n(await w("name",i));break;case t.SHOW:n(await v("name",i));break;case t.EPISODE:n(await I("name",i));break;case t.PROFILE:n(await A("name",a.username));break;case t.FOLDER:n((await Spicetify.Platform.RootlistAPI.getContents()).items.filter(e=>"folder"===e.type&&e.uri.includes(i))[0].name)}}catch(e){Spicetify.showNotification(r.error+": "+e.message)}},e=>{if(1!==e.length)return!1;var t=Spicetify.URI["Type"];switch(Spicetify.URI.fromString(e[0]).type){case t.TRACK:case t.LOCAL:case t.LOCAL_ARTIST:case t.LOCAL_ALBUM:case t.ALBUM:case t.ARTIST:case t.PLAYLIST:case t.PLAYLIST_V2:case t.SHOW:case t.EPISODE:case t.PROFILE:case t.FOLDER:return!0;default:return!1}},"copy").register(),new Spicetify.ContextMenu.Item(r.songAndArtist,async e=>{var t,a,i,s=Spicetify.URI["Type"],e=Spicetify.URI.fromString(e[0]);try{e.type===s.TRACK&&([t,a]=await Promise.allSettled([h(e.toURI()),async function(e){var t=Spicetify.GraphQL.Definitions["queryTrackArtists"];try{var a=(await Spicetify.GraphQL.Request(t,{uri:e,offset:0,limit:10}))["data"];return a.trackUnion.artists.items.map(e=>e.profile.name).join(", ")}catch(e){throw console.log(e),new Error(e.message)}}(e.toURI())]),"fulfilled"===t.status)&&"fulfilled"===a.status&&(i=new f(m.NAME,m.ID),n(t.value+i.getFieldValue(m.SEPARATOR.KEY)+a.value))}catch(e){Spicetify.showNotification(r.error+": "+e.message)}},e=>{var t;return 1===e.length&&(t=Spicetify.URI["Type"],Spicetify.URI.fromString(e[0]).type===t.TRACK)},"artist").register(),new Spicetify.ContextMenu.Item(r.copyImage,async e=>{var t=Spicetify.URI["Type"],a=Spicetify.URI.fromString(e[0]),i=a._base62Id||a.id;try{switch(a.type){case t.TRACK:n(await h(a.toURI()));break;case t.ALBUM:n(await y("image",a.id));break;case t.ARTIST:n(await g("image",a.toURI()));break;case t.PLAYLIST:case t.PLAYLIST_V2:n(await w("image",i));break;case t.SHOW:n(await v("image",i));break;case t.EPISODE:n(await I("image",i));break;case t.PROFILE:n(await A("image",a.username))}}catch(e){Spicetify.showNotification(r.error+": "+e.message)}},e=>{if(1!==e.length)return!1;var t=Spicetify.URI["Type"];switch(Spicetify.URI.fromString(e[0]).type){case t.ALBUM:case t.ARTIST:case t.PLAYLIST:case t.PLAYLIST_V2:case t.SHOW:case t.EPISODE:case t.PROFILE:return!0;default:return!1}},"copy").register()}}();